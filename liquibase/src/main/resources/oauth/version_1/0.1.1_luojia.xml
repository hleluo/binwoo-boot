<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
  <changeSet author="luojia" id="0.1.1 create table t_user">

    <!-- 用户信息表 -->
    <createTable tableName="t_user" remarks="用户信息表">
      <column name="id" type="VARCHAR(36)" remarks="主键">
        <constraints primaryKey="true"/>
      </column>
      <column name="username" type="VARCHAR(50)" remarks="用户名"/>
      <column name="mobile" type="VARCHAR(20)" remarks="手机号"/>
      <column name="email" type="VARCHAR(50)" remarks="邮箱"/>
      <column name="password" type="VARCHAR(200)" remarks="密码"/>
      <column name="disable" type="BOOLEAN" defaultValue="false" remarks="是否禁用"/>
      <column name="deleted" type="BOOLEAN" defaultValue="false" remarks="是否删除"/>
      <column name="category" type="VARCHAR(100)" remarks="类别"/>
      <column name="type" type="VARCHAR(100)" remarks="类型"/>
      <column name="source_id" type="VARCHAR(50)" remarks="来源"/>
      <column name="theme" type="VARCHAR(100)" remarks="主题"/>
      <column name="thumbnail" type="TEXT" remarks="头像"/>
      <column name="expire_time" type="TIMESTAMP" remarks="过期时间"/>
      <column name="create_time" type="TIMESTAMP" remarks="创建时间"/>
      <column name="update_time" type="TIMESTAMP" remarks="更新时间"/>
    </createTable>

    <createIndex tableName="t_user" indexName="t_user_index_username">
      <column name="username" type="VARCHAR(50)" remarks="用户名"/>
    </createIndex>

    <createIndex tableName="t_user" indexName="t_user_index_mobile">
      <column name="mobile" type="VARCHAR(20)" remarks="手机号"/>
    </createIndex>

    <!-- 新建默认超级管理员用户，账号：root，密码：U9yK%K -->
    <insert tableName="t_user">
      <column name="id" value="6a1ca001-1fa0-451e-b19c-9aa65e6e9c51"/>
      <column name="username" value="root"/>
      <column name="password" value="$2a$10$WnC8IUdCs4c1.aMreXapb.zm94PBGHgGdHIL/qFuy1.i/jGNRzNVi"/>
      <column name="create_time" value="now()"/>
      <column name="update_time" value="now()"/>
    </insert>

    <!-- 组信息 -->
    <createTable tableName="t_group" remarks="组信息表">
      <column name="id" type="VARCHAR(36)" remarks="主键">
        <constraints primaryKey="true"/>
      </column>
      <column name="type" type="VARCHAR(100)" remarks="类型"/>
      <column name="domain" type="VARCHAR(100)" remarks="系统类型"/>
      <column name="platform" type="VARCHAR(100)" remarks="平台类型"/>
      <column name="name" type="VARCHAR(200)" remarks="名称"/>
      <column name="create_time" type="TIMESTAMP" remarks="创建时间"/>
      <column name="update_time" type="TIMESTAMP" remarks="更新时间"/>
    </createTable>

    <createIndex tableName="t_group" indexName="t_group_index_type">
      <column name="type" type="VARCHAR(100)" remarks="类型"/>
    </createIndex>

    <!-- 用户组信息 -->
    <createTable tableName="t_user_group" remarks="用户组信息表">
      <column name="user_id" type="VARCHAR(36)" remarks="用户id"/>
      <column name="group_id" type="VARCHAR(36)" remarks="组id"/>
    </createTable>
    <addPrimaryKey tableName="t_user_group" constraintName="t_user_group_primary"
      columnNames="user_id,group_id"/>

    <rollback>
      <dropPrimaryKey tableName="t_user_group" constraintName="t_user_group_primary"/>
      <dropTable tableName="t_user_group"/>

      <dropIndex tableName="t_group" indexName="t_group_index_type"/>
      <dropTable tableName="t_group"/>

      <dropIndex tableName="t_user" indexName="t_user_index_mobile"/>
      <dropIndex tableName="t_user" indexName="t_user_index_username"/>
      <dropTable tableName="t_user"/>
    </rollback>

  </changeSet>

</databaseChangeLog>
